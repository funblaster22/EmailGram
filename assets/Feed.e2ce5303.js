var ce=Object.defineProperty,ue=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var j=(n,e,t)=>e in n?ce(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$=(n,e)=>{for(var t in e||(e={}))fe.call(e,t)&&j(n,t,e[t]);if(x)for(var t of x(e))de.call(e,t)&&j(n,t,e[t]);return n},ee=(n,e)=>ue(n,me(e));import{S as A,i as U,s as W,e as b,b as ge,a as M,n as P,d as N,c as he,o as ie,f as ae,g as y,t as te,h as L,j as d,k as S,l as f,m as D,p as ne,q as z,r as T,u as F,v as _e,w as be,x as pe,y as ve,z as ye,A as Ie}from"./index.7c0ff3be.js";import{s as oe}from"./svelte.12aa2442.js";import{S as se}from"./Spacer.be7c3e9b.js";import{u as ke,g as we,a as Me,f as Ne,b as Ee}from"./gapi.e7450da9.js";function Se(n){let e;return{c(){e=b("div"),ge(e,"width","0")},m(t,l){M(t,e,l),n[5](e)},p:P,i:P,o:P,d(t){t&&N(e),n[5](null)}}}function ze(n,e,t){let{threshold:l=0}=e,{horizontal:o=!1}=e,{elementScroll:r}=e,{hasMore:u=!0}=e;const a=he();let g=!1,s;const i=c=>{c.target,(o?c.target.scrollWidth-c.target.clientWidth-c.target.scrollLeft:c.target.scrollHeight-c.target.clientHeight-c.target.scrollTop)<=l?(!g&&u&&a("loadMore"),g=!0):g=!1};ie(()=>{if(s||r){const c=r||s.parentNode;c.removeEventListener("scroll",null),c.removeEventListener("resize",null)}});function h(c){ae[c?"unshift":"push"](()=>{s=c,t(0,s)})}return n.$$set=c=>{"threshold"in c&&t(1,l=c.threshold),"horizontal"in c&&t(2,o=c.horizontal),"elementScroll"in c&&t(3,r=c.elementScroll),"hasMore"in c&&t(4,u=c.hasMore)},n.$$.update=()=>{if(n.$$.dirty&9&&(s||r)){const c=r||s.parentNode;c.addEventListener("scroll",i),c.addEventListener("resize",i)}},[s,l,o,r,u,h]}class Te extends A{constructor(e){super(),U(this,e,ze,Se,W,{threshold:1,horizontal:2,elementScroll:3,hasMore:4})}}function qe(n){let e;return{c(){e=b("iframe"),d(e,"class","h-full w-full overflow-hidden"),d(e,"srcdoc",n[3]),d(e,"scrolling","no"),d(e,"disabled","")},m(t,l){M(t,e,l)},p(t,l){l&8&&d(e,"srcdoc",t[3])},d(t){t&&N(e)}}}function Le(n){let e,t;return{c(){e=b("img"),d(e,"class","h-full w-full"),S(e.src,t=n[4][0])||d(e,"src",t),d(e,"alt","TODO")},m(l,o){M(l,e,o)},p(l,o){o&16&&!S(e.src,t=l[4][0])&&d(e,"src",t)},d(l){l&&N(e)}}}function De(n){let e,t,l,o,r,u,a,g,s,i,h,c,m,G,Q,E,X,p,R,J,B,K,w,V,C,Y,H,O,I;i=new se({});function Z(_,k){return _[4][0]?Le:qe}let q=Z(n),v=q(n);return w=new se({}),{c(){e=b("div"),t=b("div"),l=b("button"),o=b("img"),u=y(),a=b("span"),g=te(n[0]),s=y(),L(i.$$.fragment),h=y(),c=b("button"),m=b("img"),Q=y(),E=b("div"),v.c(),X=y(),p=b("div"),R=b("button"),R.textContent="\u2764\uFE0F",J=y(),B=b("button"),B.textContent="\u{1F4AC}",K=y(),L(w.$$.fragment),V=y(),C=b("button"),C.textContent="\u{1F6A9}",Y=y(),H=b("p"),O=te(n[2]),d(o,"class","h-4 rounded-full"),S(o.src,r=n[1])||d(o,"src",r),d(o,"alt","profile picture"),d(m,"class","h-4"),S(m.src,G=oe)||d(m,"src",G),d(m,"alt","more options"),d(t,"class","flex h-4 items-center"),d(E,"class","aspect-square w-full border border-red"),d(p,"class","flex"),d(e,"class","border border-black")},m(_,k){M(_,e,k),f(e,t),f(t,l),f(l,o),f(t,u),f(t,a),f(a,g),f(t,s),D(i,t,null),f(t,h),f(t,c),f(c,m),f(e,Q),f(e,E),v.m(E,null),f(e,X),f(e,p),f(p,R),f(p,J),f(p,B),f(p,K),D(w,p,null),f(p,V),f(p,C),f(e,Y),f(e,H),f(H,O),n[7](e),I=!0},p(_,[k]){(!I||k&2&&!S(o.src,r=_[1]))&&d(o,"src",r),(!I||k&1)&&ne(g,_[0]),q===(q=Z(_))&&v?v.p(_,k):(v.d(1),v=q(_),v&&(v.c(),v.m(E,null))),(!I||k&4)&&ne(O,_[2])},i(_){I||(z(i.$$.fragment,_),z(w.$$.fragment,_),I=!0)},o(_){T(i.$$.fragment,_),T(w.$$.fragment,_),I=!1},d(_){_&&N(e),F(i),v.d(),F(w),n[7](null)}}}function Fe(n,e,t){let{id:l}=e,{senderName:o}=e,{senderImg:r}=e,{description:u}=e,{body:a}=e,{mainImg:g}=e,s;function i(){console.log("Message",l,"has been read"),h.disconnect(),gapi.client.gmail.users.messages.modify({userId:"me",id:l,resource:{removeLabelIds:["UNREAD"]}})}const h=new IntersectionObserver(function(m){m[0].isIntersecting===!0&&i()},{threshold:[1]});_e(()=>{h.observe(s)}),ie(()=>{h.disconnect()});function c(m){ae[m?"unshift":"push"](()=>{s=m,t(5,s)})}return n.$$set=m=>{"id"in m&&t(6,l=m.id),"senderName"in m&&t(0,o=m.senderName),"senderImg"in m&&t(1,r=m.senderImg),"description"in m&&t(2,u=m.description),"body"in m&&t(3,a=m.body),"mainImg"in m&&t(4,g=m.mainImg)},[o,r,u,a,g,s,l,c]}class Re extends A{constructor(e){super(),U(this,e,Fe,De,W,{id:6,senderName:0,senderImg:1,description:2,body:3,mainImg:4})}}function le(n,e,t){const l=n.slice();return l[4]=e[t],l}function re(n,e){let t,l,o;return l=new Re({props:{id:e[4].id,senderName:e[4].senderName,senderImg:oe,description:e[4].snippet,mainImg:e[4].imgs,body:e[4].body}}),{key:n,first:null,c(){t=be(),L(l.$$.fragment),this.first=t},m(r,u){M(r,t,u),D(l,r,u),o=!0},p(r,u){e=r;const a={};u&1&&(a.id=e[4].id),u&1&&(a.senderName=e[4].senderName),u&1&&(a.description=e[4].snippet),u&1&&(a.mainImg=e[4].imgs),u&1&&(a.body=e[4].body),l.$set(a)},i(r){o||(z(l.$$.fragment,r),o=!0)},o(r){T(l.$$.fragment,r),o=!1},d(r){r&&N(t),F(l,r)}}}function Be(n){let e,t=[],l=new Map,o,r,u,a=n[0];const g=s=>s[4].id;for(let s=0;s<a.length;s+=1){let i=le(n,a,s),h=g(i);l.set(h,t[s]=re(h,i))}return r=new Te({props:{hasMore:!0,threshold:100}}),r.$on("loadMore",n[1]),{c(){e=b("div");for(let s=0;s<t.length;s+=1)t[s].c();o=y(),L(r.$$.fragment),d(e,"class","main h-screen overflow-y-auto svelte-5bzbga")},m(s,i){M(s,e,i);for(let h=0;h<t.length;h+=1)t[h].m(e,null);f(e,o),D(r,e,null),u=!0},p(s,[i]){i&1&&(a=s[0],pe(),t=ve(t,i,g,1,s,a,l,e,Ie,re,o,le),ye())},i(s){if(!u){for(let i=0;i<a.length;i+=1)z(t[i]);z(r.$$.fragment,s),u=!0}},o(s){for(let i=0;i<t.length;i+=1)T(t[i]);T(r.$$.fragment,s),u=!1},d(s){s&&N(e);for(let i=0;i<t.length;i+=1)t[i].d();F(r)}}}function Ce(n){const e=document.createElement("div");return e.innerHTML=n,e.innerText}function He(n){return n.replaceAll(/[\u200B-\u200D\uFEFF]/g,"").trim()}function Oe(n,e,t){let l=[],o;ke.subscribe(a=>{a?r():t(0,l=[])});function r(){const a=gapi.client.gmail.users.messages.list({userId:"me",labelIds:"INBOX",maxResults:10,q:"is:unread unsubscribe",pageToken:o});console.log("REQUEST",a),a.execute(function(g){o=g.result.nextPageToken;for(const s of g.result.messages)gapi.client.gmail.users.messages.get({userId:"me",id:s.id}).execute(u)})}function u(a){console.log(a);const g=we(a.payload);Promise.all(Me(a.payload).map(s=>gapi.client.gmail.users.messages.attachments.get({userId:"me",messageId:a.id,id:s.body.attachmentId}).then(i=>ee($({},i),{mime:s.mimeType,alt:s.filename})))).then(s=>{let i=s.map(h=>"data:"+h.mime+";base64,"+Ne(h.result.data));console.log(s),t(0,l=[...l,{id:a.id,snippet:He(Ce(a.snippet)),senderName:Ee(a.payload.headers,"From"),date:new Date(a.internalDate),body:g,imgs:i}])})}return[l,r]}class Qe extends A{constructor(e){super(),U(this,e,Oe,Be,W,{})}}export{Qe as default};
