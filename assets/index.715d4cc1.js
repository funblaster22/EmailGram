var be=Object.defineProperty,ye=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var se=(l,e,t)=>e in l?be(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,le=(l,e)=>{for(var t in e||(e={}))we.call(e,t)&&se(l,t,e[t]);if(ne)for(var t of ne(e))ke.call(e,t)&&se(l,t,e[t]);return l},re=(l,e)=>ye(l,Ie(e));import{S as M,i as E,s as N,e as f,a as c,b,n as _,d as y,c as Se,f as xe,o as me,g as de,h as v,t as K,j as T,k as A,l as u,m as D,p as V,q as x,r as C,u as q,v as Ce,w as Me,x as ge,y as Ee,z as Ne,A as ze,B as Te,C as z,D as De,E as pe,F as qe,G as he,R as Le}from"./vendor.8547deb2.js";const $e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}};$e();var Z="/EmailGram/assets/svelte.d72399d3.png";function je(l){let e;return{c(){e=f("div"),c(e,"class","flex-grow-[999]")},m(t,s){b(t,e,s)},p:_,i:_,o:_,d(t){t&&y(e)}}}class ie extends M{constructor(e){super();E(this,e,null,je,N,{})}}function Ae(l){let e;return{c(){e=f("div"),Se(e,"width","0")},m(t,s){b(t,e,s),l[5](e)},p:_,i:_,o:_,d(t){t&&y(e),l[5](null)}}}function Oe(l,e,t){let{threshold:s=0}=e,{horizontal:n=!1}=e,{elementScroll:r}=e,{hasMore:a=!0}=e;const i=xe();let p=!1,m;const h=o=>{o.target,(n?o.target.scrollWidth-o.target.clientWidth-o.target.scrollLeft:o.target.scrollHeight-o.target.clientHeight-o.target.scrollTop)<=s?(!p&&a&&i("loadMore"),p=!0):p=!1};me(()=>{if(m||r){const o=r||m.parentNode;o.removeEventListener("scroll",null),o.removeEventListener("resize",null)}});function d(o){de[o?"unshift":"push"](()=>{m=o,t(0,m)})}return l.$$set=o=>{"threshold"in o&&t(1,s=o.threshold),"horizontal"in o&&t(2,n=o.horizontal),"elementScroll"in o&&t(3,r=o.elementScroll),"hasMore"in o&&t(4,a=o.hasMore)},l.$$.update=()=>{if(l.$$.dirty&9&&(m||r)){const o=r||m.parentNode;o.addEventListener("scroll",h),o.addEventListener("resize",h)}},[m,s,n,r,a,d]}class Be extends M{constructor(e){super();E(this,e,Oe,Ae,N,{threshold:1,horizontal:2,elementScroll:3,hasMore:4})}}function Re(l){let e;return{c(){e=f("iframe"),c(e,"class","h-full w-full overflow-hidden"),c(e,"srcdoc",l[3]),c(e,"scrolling","no"),c(e,"disabled","")},m(t,s){b(t,e,s)},p(t,s){s&8&&c(e,"srcdoc",t[3])},d(t){t&&y(e)}}}function Fe(l){let e,t;return{c(){e=f("img"),c(e,"class","h-full w-full"),A(e.src,t=l[4][0])||c(e,"src",t),c(e,"alt","TODO")},m(s,n){b(s,e,n)},p(s,n){n&16&&!A(e.src,t=s[4][0])&&c(e,"src",t)},d(s){s&&y(e)}}}function Pe(l){let e,t,s,n,r,a,i,p,m,h,d,o,g,P,k,S,G,w,O,L,j,X,F,J,H,ee,W,Y,B;h=new ie({});function te(I,R){return I[4][0]?Fe:Re}let U=te(l),$=U(l);return F=new ie({}),{c(){e=f("div"),t=f("div"),s=f("button"),n=f("img"),a=v(),i=f("span"),p=K(l[0]),m=v(),T(h.$$.fragment),d=v(),o=f("button"),g=f("img"),k=v(),S=f("div"),$.c(),G=v(),w=f("div"),O=f("button"),O.textContent="\u2764\uFE0F",L=v(),j=f("button"),j.textContent="\u{1F4AC}",X=v(),T(F.$$.fragment),J=v(),H=f("button"),H.textContent="\u{1F6A9}",ee=v(),W=f("p"),Y=K(l[2]),c(n,"class","h-4 rounded-full"),A(n.src,r=l[1])||c(n,"src",r),c(n,"alt","profile picture"),c(g,"class","h-4"),A(g.src,P=Z)||c(g,"src",P),c(g,"alt","more options"),c(t,"class","flex h-4 items-center"),c(S,"class","aspect-square w-full border border-red"),c(w,"class","flex"),c(e,"class","border border-black")},m(I,R){b(I,e,R),u(e,t),u(t,s),u(s,n),u(t,a),u(t,i),u(i,p),u(t,m),D(h,t,null),u(t,d),u(t,o),u(o,g),u(e,k),u(e,S),$.m(S,null),u(e,G),u(e,w),u(w,O),u(w,L),u(w,j),u(w,X),D(F,w,null),u(w,J),u(w,H),u(e,ee),u(e,W),u(W,Y),l[7](e),B=!0},p(I,[R]){(!B||R&2&&!A(n.src,r=I[1]))&&c(n,"src",r),(!B||R&1)&&V(p,I[0]),U===(U=te(I))&&$?$.p(I,R):($.d(1),$=U(I),$&&($.c(),$.m(S,null))),(!B||R&4)&&V(Y,I[2])},i(I){B||(x(h.$$.fragment,I),x(F.$$.fragment,I),B=!0)},o(I){C(h.$$.fragment,I),C(F.$$.fragment,I),B=!1},d(I){I&&y(e),q(h),$.d(),q(F),l[7](null)}}}function Ge(l,e,t){let{id:s}=e,{senderName:n}=e,{senderImg:r}=e,{description:a}=e,{body:i}=e,{mainImg:p}=e,m;function h(){console.log("Message",s,"has been read"),d.disconnect(),gapi.client.gmail.users.messages.modify({userId:"me",id:s,resource:{removeLabelIds:["UNREAD"]}})}const d=new IntersectionObserver(function(g){g[0].isIntersecting===!0&&h()},{threshold:[1]});Ce(()=>{d.observe(m)}),me(()=>{d.disconnect()});function o(g){de[g?"unshift":"push"](()=>{m=g,t(5,m)})}return l.$$set=g=>{"id"in g&&t(6,s=g.id),"senderName"in g&&t(0,n=g.senderName),"senderImg"in g&&t(1,r=g.senderImg),"description"in g&&t(2,a=g.description),"body"in g&&t(3,i=g.body),"mainImg"in g&&t(4,p=g.mainImg)},[n,r,a,i,p,m,s,o]}class Ue extends M{constructor(e){super();E(this,e,Ge,Pe,N,{id:6,senderName:0,senderImg:1,description:2,body:3,mainImg:4})}}const He="975670416072-iabafb9dtffjf2ipq4tqmfj4min62k17.apps.googleusercontent.com",We="AIzaSyDDWq6ZoZkDIVbhmkIYdRlg3Lapuhm1WrY",Ye=["https://www.googleapis.com/auth/gmail.modify"],Ke=["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"],{set:Ve,subscribe:Ze}=Me(!1),ve={subscribe:Ze};function Qe(){gapi.load("client:auth2",Xe)}Qe();function Xe(){gapi.client.init({apiKey:We,clientId:He,discoveryDocs:Ke,scope:Ye.join(" ")}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen(ae),ae(gapi.auth2.getAuthInstance().isSignedIn.get())},console.log)}function ae(l){Ve(l),console.log("SIGNED",l?"IN!":"OUT!")}function Je(l){gapi.auth2.getAuthInstance().signIn()}function et(l){gapi.auth2.getAuthInstance().signOut()}function tt(l,e){for(const t of l)if(t.name===e)return t.value}function _e(l){return l.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")}function nt(l){const e=Q(l,"parts").filter(t=>t.mimeType==="text/html")[0].body.data;return decodeURIComponent(escape(window.atob(_e(e))))}function Q(l,e){let t=[];if(l[e]===void 0)return[l];for(const s of l[e])t=t.concat(Q(s,e));return console.log(t),t}function st(l){return Q(l,"parts").filter(e=>e.mimeType.includes("image/"))}function oe(l,e,t){const s=l.slice();return s[4]=e[t],s}function ce(l,e){let t,s,n;return s=new Ue({props:{id:e[4].id,senderName:e[4].senderName,senderImg:Z,description:e[4].snippet,mainImg:e[4].imgs,body:e[4].body}}),{key:l,first:null,c(){t=ge(),T(s.$$.fragment),this.first=t},m(r,a){b(r,t,a),D(s,r,a),n=!0},p(r,a){e=r;const i={};a&1&&(i.id=e[4].id),a&1&&(i.senderName=e[4].senderName),a&1&&(i.description=e[4].snippet),a&1&&(i.mainImg=e[4].imgs),a&1&&(i.body=e[4].body),s.$set(i)},i(r){n||(x(s.$$.fragment,r),n=!0)},o(r){C(s.$$.fragment,r),n=!1},d(r){r&&y(t),q(s,r)}}}function lt(l){let e,t,s,n=[],r=new Map,a,i,p,m=l[0];const h=d=>d[4].id;for(let d=0;d<m.length;d+=1){let o=oe(l,m,d),g=h(o);r.set(g,n[d]=ce(g,o))}return i=new Be({props:{hasMore:!0,threshold:100}}),i.$on("loadMore",l[1]),{c(){e=f("div"),t=f("input"),s=v();for(let d=0;d<n.length;d+=1)n[d].c();a=v(),T(i.$$.fragment),t.value="unsubscribe",c(t,"placeholder","search query"),c(e,"class","main h-screen overflow-y-auto svelte-5bzbga")},m(d,o){b(d,e,o),u(e,t),u(e,s);for(let g=0;g<n.length;g+=1)n[g].m(e,null);u(e,a),D(i,e,null),p=!0},p(d,[o]){o&1&&(m=d[0],Ee(),n=Ne(n,o,h,1,d,m,r,e,Te,ce,a,oe),ze())},i(d){if(!p){for(let o=0;o<m.length;o+=1)x(n[o]);x(i.$$.fragment,d),p=!0}},o(d){for(let o=0;o<n.length;o+=1)C(n[o]);C(i.$$.fragment,d),p=!1},d(d){d&&y(e);for(let o=0;o<n.length;o+=1)n[o].d();q(i)}}}function rt(l){const e=document.createElement("div");return e.innerHTML=l,e.innerText}function it(l){return l.replaceAll(/[\u200B-\u200D\uFEFF]/g,"").trim()}function at(l,e,t){let s=[],n;ve.subscribe(i=>{i?r():t(0,s=[])});function r(){const i=gapi.client.gmail.users.messages.list({userId:"me",labelIds:"INBOX",maxResults:10,q:"is:unread unsubscribe",pageToken:n});console.log("REQUEST",i),i.execute(function(p){n=p.result.nextPageToken;for(const m of p.result.messages)gapi.client.gmail.users.messages.get({userId:"me",id:m.id}).execute(a)})}function a(i){console.log(i);const p=nt(i.payload);Promise.all(st(i.payload).map(m=>gapi.client.gmail.users.messages.attachments.get({userId:"me",messageId:i.id,id:m.body.attachmentId}).then(h=>re(le({},h),{mime:m.mimeType,alt:m.filename})))).then(m=>{let h=m.map(d=>"data:"+d.mime+";base64,"+_e(d.result.data));console.log(m),t(0,s=[...s,{id:i.id,snippet:it(rt(i.snippet)),senderName:tt(i.payload.headers,"From"),date:new Date(i.internalDate),body:p,imgs:h}])})}return[s,r]}class ot extends M{constructor(e){super();E(this,e,at,lt,N,{})}}function ct(l){let e,t,s;return{c(){e=f("div"),t=f("img"),A(t.src,s=Z)||c(t,"src",s),c(t,"alt","user"),c(e,"class","aspect-square rounded-full bg-gray-200 m-1")},m(n,r){b(n,e,r),u(e,t)},p:_,i:_,o:_,d(n){n&&y(e)}}}class ut extends M{constructor(e){super();E(this,e,null,ct,N,{})}}function ft(l){let e,t,s,n,r,a,i,p,m,h,d;return n=new ut({}),{c(){e=f("a"),t=f("div"),s=f("div"),T(n.$$.fragment),r=v(),a=f("div"),a.textContent="Ethan Dawes",i=v(),p=f("div"),p.textContent="Yesterday, Monday >",m=v(),h=f("div"),h.textContent="The quick brown fox jumped over the lazy dog",c(s,"class","img svelte-1hn8m2z"),c(a,"class","addr whitespace-nowrap overflow-ellipsis overflow-x-hidden mr-1 svelte-1hn8m2z"),c(p,"class","time svelte-1hn8m2z"),c(h,"class","snippet border-b border-gray-300 overflow-hidden svelte-1hn8m2z"),c(t,"class","container svelte-1hn8m2z"),c(e,"href","#/message/10")},m(o,g){b(o,e,g),u(e,t),u(t,s),D(n,s,null),u(t,r),u(t,a),u(t,i),u(t,p),u(t,m),u(t,h),d=!0},p:_,i(o){d||(x(n.$$.fragment,o),d=!0)},o(o){C(n.$$.fragment,o),d=!1},d(o){o&&y(e),q(n)}}}class ue extends M{constructor(e){super();E(this,e,null,ft,N,{})}}function mt(l){let e,t,s,n,r,a;return s=new ue({}),r=new ue({}),{c(){e=f("input"),t=v(),T(s.$$.fragment),n=v(),T(r.$$.fragment),c(e,"placeholder","Search")},m(i,p){b(i,e,p),b(i,t,p),D(s,i,p),b(i,n,p),D(r,i,p),a=!0},p:_,i(i){a||(x(s.$$.fragment,i),x(r.$$.fragment,i),a=!0)},o(i){C(s.$$.fragment,i),C(r.$$.fragment,i),a=!1},d(i){i&&y(e),i&&y(t),q(s,i),i&&y(n),q(r,i)}}}class dt extends M{constructor(e){super();E(this,e,null,mt,N,{})}}function gt(l){let e,t;return{c(){e=f("p"),t=K(l[1]),c(e,"class","from-me from-them emoji svelte-zsm8so"),z(e,"from-them",!l[0]),z(e,"from-me",l[0]),z(e,"emoji",l[2])},m(s,n){b(s,e,n),u(e,t)},p(s,[n]){n&2&&V(t,s[1]),n&1&&z(e,"from-them",!s[0]),n&1&&z(e,"from-me",s[0])},i:_,o:_,d(s){s&&y(e)}}}function pt(l,e,t){let{isMe:s}=e,{slot:n=""}=e,r=(n.match(/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/g)||[]).length,a=r>0&&r<=3;return console.log(r,a),l.$$set=i=>{"isMe"in i&&t(0,s=i.isMe),"slot"in i&&t(1,n=i.slot)},[s,n,a]}class fe extends M{constructor(e){super();E(this,e,pt,gt,N,{isMe:0,slot:1})}}function ht(l){let e,t,s,n,r;return t=new fe({props:{isMe:!0,slot:"\u{1F600}"}}),n=new fe({props:{isMe:!1,slot:"hello"}}),{c(){e=f("div"),T(t.$$.fragment),s=v(),T(n.$$.fragment),c(e,"class","imessage svelte-1jc515a")},m(a,i){b(a,e,i),D(t,e,null),u(e,s),D(n,e,null),r=!0},p:_,i(a){r||(x(t.$$.fragment,a),x(n.$$.fragment,a),r=!0)},o(a){C(t.$$.fragment,a),C(n.$$.fragment,a),r=!1},d(a){a&&y(e),q(t),q(n)}}}class vt extends M{constructor(e){super();E(this,e,null,ht,N,{})}}var _t="/EmailGram/assets/home.378a979e.svg",bt="/EmailGram/assets/chat.044c3ddb.svg",yt="/EmailGram/assets/account.f442b139.svg";function It(l){let e,t,s,n,r,a,i,p,m,h,d,o,g,P,k,S,G,w,O;return{c(){e=f("div"),t=f("div"),s=f("a"),n=f("img"),a=v(),i=f("span"),i.textContent="Feed",p=v(),m=f("a"),h=f("img"),o=v(),g=f("span"),g.textContent="Messages",P=v(),k=f("a"),S=f("img"),w=v(),O=f("span"),O.textContent="Account",A(n.src,r=_t)||c(n,"src",r),c(n,"alt","home icon"),c(n,"class","svelte-ch3je"),c(i,"class","svelte-ch3je"),c(s,"class","item svelte-ch3je"),c(s,"href","#/"),z(s,"active",l[0]==="/"),A(h.src,d=bt)||c(h,"src",d),c(h,"alt","chat bubble icon"),c(h,"class","svelte-ch3je"),c(g,"class","svelte-ch3je"),c(m,"class","item svelte-ch3je"),c(m,"href","#/message"),z(m,"active",l[0]==="/message"),A(S.src,G=yt)||c(S,"src",G),c(S,"alt","account icon"),c(S,"class","svelte-ch3je"),c(O,"class","svelte-ch3je"),c(k,"class","item svelte-ch3je"),c(k,"href","#/account"),z(k,"active",l[0]==="/account"),c(t,"class","flex svelte-ch3je"),c(e,"class",De("navigation hor compact")+" svelte-ch3je")},m(L,j){b(L,e,j),u(e,t),u(t,s),u(s,n),u(s,a),u(s,i),u(t,p),u(t,m),u(m,h),u(m,o),u(m,g),u(t,P),u(t,k),u(k,S),u(k,w),u(k,O)},p(L,[j]){j&1&&z(s,"active",L[0]==="/"),j&1&&z(m,"active",L[0]==="/message"),j&1&&z(k,"active",L[0]==="/account")},i:_,o:_,d(L){L&&y(e)}}}function wt(l,e,t){let s;return pe(l,qe,n=>t(0,s=n)),console.log(s),[s]}class kt extends M{constructor(e){super();E(this,e,wt,It,N,{})}}function St(l){let e,t,s;return{c(){e=f("button"),e.textContent="Sign in"},m(n,r){b(n,e,r),t||(s=he(e,"click",Je),t=!0)},p:_,d(n){n&&y(e),t=!1,s()}}}function xt(l){let e,t,s;return{c(){e=f("button"),e.textContent="Sign out"},m(n,r){b(n,e,r),t||(s=he(e,"click",et),t=!0)},p:_,d(n){n&&y(e),t=!1,s()}}}function Ct(l){let e;function t(r,a){return r[0]?xt:St}let s=t(l),n=s(l);return{c(){n.c(),e=ge()},m(r,a){n.m(r,a),b(r,e,a)},p(r,[a]){s===(s=t(r))&&n?n.p(r,a):(n.d(1),n=s(r),n&&(n.c(),n.m(e.parentNode,e)))},i:_,o:_,d(r){n.d(r),r&&y(e)}}}function Mt(l,e,t){let s;return pe(l,ve,n=>t(0,s=n)),[s]}class Et extends M{constructor(e){super();E(this,e,Mt,Ct,N,{})}}function Nt(l){let e,t,s,n,r,a;return s=new Le({props:{routes:{"/":ot,"/message":dt,"/message/:conversationId":vt,"/account":Et}}}),r=new kt({}),{c(){e=f("main"),t=f("div"),T(s.$$.fragment),n=v(),T(r.$$.fragment),c(t,"class","flex-grow-[999] overflow-auto"),c(e,"class","max-w-lg h-screen mx-auto w-screen border border-black flex flex-col")},m(i,p){b(i,e,p),u(e,t),D(s,t,null),u(e,n),D(r,e,null),a=!0},p:_,i(i){a||(x(s.$$.fragment,i),x(r.$$.fragment,i),a=!0)},o(i){C(s.$$.fragment,i),C(r.$$.fragment,i),a=!1},d(i){i&&y(e),q(s),q(r)}}}class zt extends M{constructor(e){super();E(this,e,null,Nt,N,{})}}new zt({target:document.getElementById("app")});
