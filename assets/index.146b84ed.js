import{S as P,i as R,s as x,e as p,a as m,b as k,n as N,d as w,c as y,t as j,f as T,g as O,h as f,m as A,j as $,k as D,l as q,o as z,w as oe,p as ae,q as ce,r as ue,u as fe,v as de,x as me,y as ge,z as pe,A as he,B as _e,C as le}from"./vendor.9118fd6d.js";const be=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}};be();var ie="/EmailGram/assets/svelte.d72399d3.png";function ye(r){let e;return{c(){e=p("div"),m(e,"class","flex-grow-[999]")},m(t,n){k(t,e,n)},p:N,i:N,o:N,d(t){t&&w(e)}}}class ee extends P{constructor(e){super();R(this,e,null,ye,x,{})}}function Ie(r){let e;return{c(){e=p("iframe"),m(e,"class","h-full w-full overflow-hidden"),m(e,"srcdoc",r[3]),m(e,"scrolling","no"),m(e,"disabled","")},m(t,n){k(t,e,n)},p(t,n){n&8&&m(e,"srcdoc",t[3])},d(t){t&&w(e)}}}function ve(r){let e,t;return{c(){e=p("img"),m(e,"class","h-full w-full"),O(e.src,t=r[4][0])||m(e,"src",t),m(e,"alt","TODO")},m(n,s){k(n,e,s)},p(n,s){s&16&&!O(e.src,t=n[4][0])&&m(e,"src",t)},d(n){n&&w(e)}}}function ke(r){let e,t,n,s,l,a,g,i,h,u,_,c,o,d,S,M,K,I,F,V,H,Z,L,Q,W,X,G,U,C;u=new ee({});function J(b,E){return b[4][0]?ve:Ie}let B=J(r),v=B(r);return L=new ee({}),{c(){e=p("div"),t=p("div"),n=p("button"),s=p("img"),a=y(),g=p("span"),i=j(r[0]),h=y(),T(u.$$.fragment),_=y(),c=p("button"),o=p("img"),S=y(),M=p("div"),v.c(),K=y(),I=p("div"),F=p("button"),F.textContent="\u2764\uFE0F",V=y(),H=p("button"),H.textContent="\u{1F4AC}",Z=y(),T(L.$$.fragment),Q=y(),W=p("button"),W.textContent="\u{1F6A9}",X=y(),G=p("p"),U=j(r[2]),m(s,"class","h-4 rounded-full"),O(s.src,l=r[1])||m(s,"src",l),m(s,"alt","profile picture"),m(o,"class","h-4"),O(o.src,d=ie)||m(o,"src",d),m(o,"alt","more options"),m(t,"class","flex h-4 items-center"),m(M,"class","aspect-square w-full border border-red"),m(I,"class","flex"),m(e,"class","border border-black")},m(b,E){k(b,e,E),f(e,t),f(t,n),f(n,s),f(t,a),f(t,g),f(g,i),f(t,h),A(u,t,null),f(t,_),f(t,c),f(c,o),f(e,S),f(e,M),v.m(M,null),f(e,K),f(e,I),f(I,F),f(I,V),f(I,H),f(I,Z),A(L,I,null),f(I,Q),f(I,W),f(e,X),f(e,G),f(G,U),C=!0},p(b,[E]){(!C||E&2&&!O(s.src,l=b[1]))&&m(s,"src",l),(!C||E&1)&&$(i,b[0]),B===(B=J(b))&&v?v.p(b,E):(v.d(1),v=B(b),v&&(v.c(),v.m(M,null))),(!C||E&4)&&$(U,b[2])},i(b){C||(D(u.$$.fragment,b),D(L.$$.fragment,b),C=!0)},o(b){q(u.$$.fragment,b),q(L.$$.fragment,b),C=!1},d(b){b&&w(e),z(u),v.d(),z(L)}}}function we(r,e,t){let{senderName:n}=e,{senderImg:s}=e,{description:l}=e,{body:a}=e,{mainImg:g}=e;return r.$$set=i=>{"senderName"in i&&t(0,n=i.senderName),"senderImg"in i&&t(1,s=i.senderImg),"description"in i&&t(2,l=i.description),"body"in i&&t(3,a=i.body),"mainImg"in i&&t(4,g=i.mainImg)},[n,s,l,a,g]}class Se extends P{constructor(e){super();R(this,e,we,ke,x,{senderName:0,senderImg:1,description:2,body:3,mainImg:4})}}const Ne="975670416072-iabafb9dtffjf2ipq4tqmfj4min62k17.apps.googleusercontent.com",Ce="AIzaSyDDWq6ZoZkDIVbhmkIYdRlg3Lapuhm1WrY",Ee="https://www.googleapis.com/auth/gmail.readonly",Le=["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"],{set:De,subscribe:qe}=oe(!1),te={subscribe:qe};function Me(){gapi.load("client:auth2",Oe)}Me();function Oe(){gapi.client.init({apiKey:Ce,clientId:Ne,discoveryDocs:Le,scope:Ee}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen(ne),ne(gapi.auth2.getAuthInstance().isSignedIn.get())},console.log)}function ne(r){De(r),console.log("SIGNED",r?"IN!":"OUT!")}function Te(r){gapi.auth2.getAuthInstance().signIn()}function Ae(r){gapi.auth2.getAuthInstance().signOut()}function ze(r,e){for(const t of r)if(t.name===e)return t.value}function Pe(r){const e=Y(r,"parts").filter(t=>t.mimeType==="text/html")[0].body.data.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");return decodeURIComponent(escape(window.atob(e)))}function Y(r,e){let t=[];if(r[e]===void 0)return[r];for(const n of r[e])t=t.concat(Y(n,e));return console.log(t),t}function Re(r){return Y(r,"parts").filter(e=>e.mimeType.includes("image/"))}function xe(r){let e;return{c(){e=p("div"),ae(e,"width","0")},m(t,n){k(t,e,n),r[5](e)},p:N,i:N,o:N,d(t){t&&w(e),r[5](null)}}}function Be(r,e,t){let{threshold:n=0}=e,{horizontal:s=!1}=e,{elementScroll:l}=e,{hasMore:a=!0}=e;const g=ce();let i=!1,h;const u=c=>{c.target,(s?c.target.scrollWidth-c.target.clientWidth-c.target.scrollLeft:c.target.scrollHeight-c.target.clientHeight-c.target.scrollTop)<=n?(!i&&a&&g("loadMore"),i=!0):i=!1};ue(()=>{if(h||l){const c=l||h.parentNode;c.removeEventListener("scroll",null),c.removeEventListener("resize",null)}});function _(c){fe[c?"unshift":"push"](()=>{h=c,t(0,h)})}return r.$$set=c=>{"threshold"in c&&t(1,n=c.threshold),"horizontal"in c&&t(2,s=c.horizontal),"elementScroll"in c&&t(3,l=c.elementScroll),"hasMore"in c&&t(4,a=c.hasMore)},r.$$.update=()=>{if(r.$$.dirty&9&&(h||l)){const c=l||h.parentNode;c.addEventListener("scroll",u),c.addEventListener("resize",u)}},[h,n,s,l,a,_]}class Fe extends P{constructor(e){super();R(this,e,Be,xe,x,{threshold:1,horizontal:2,elementScroll:3,hasMore:4})}}function se(r,e,t){const n=r.slice();return n[5]=e[t],n}function He(r){let e,t,n;return{c(){e=p("button"),e.textContent="Sign in"},m(s,l){k(s,e,l),t||(n=le(e,"click",Te),t=!0)},p:N,d(s){s&&w(e),t=!1,n()}}}function We(r){let e,t,n;return{c(){e=p("button"),e.textContent="Sign out"},m(s,l){k(s,e,l),t||(n=le(e,"click",Ae),t=!0)},p:N,d(s){s&&w(e),t=!1,n()}}}function re(r,e){let t,n,s;return n=new Se({props:{senderName:e[5].senderName,senderImg:ie,description:e[5].snippet,mainImg:e[5].imgs,body:e[5].body}}),{key:r,first:null,c(){t=de(),T(n.$$.fragment),this.first=t},m(l,a){k(l,t,a),A(n,l,a),s=!0},p(l,a){e=l;const g={};a&1&&(g.senderName=e[5].senderName),a&1&&(g.description=e[5].snippet),a&1&&(g.mainImg=e[5].imgs),a&1&&(g.body=e[5].body),n.$set(g)},i(l){s||(D(n.$$.fragment,l),s=!0)},o(l){q(n.$$.fragment,l),s=!1},d(l){l&&w(t),z(n,l)}}}function Ge(r){let e,t,n=[],s=new Map,l,a,g;function i(o,d){return o[1]?We:He}let h=i(r),u=h(r),_=r[0];const c=o=>o[5].id;for(let o=0;o<_.length;o+=1){let d=se(r,_,o),S=c(d);s.set(S,n[o]=re(S,d))}return a=new Fe({props:{hasMore:!0,threshold:100}}),a.$on("loadMore",r[2]),{c(){e=p("div"),u.c(),t=y();for(let o=0;o<n.length;o+=1)n[o].c();l=y(),T(a.$$.fragment),m(e,"class","h-screen overflow-y-auto")},m(o,d){k(o,e,d),u.m(e,null),f(e,t);for(let S=0;S<n.length;S+=1)n[S].m(e,null);f(e,l),A(a,e,null),g=!0},p(o,[d]){h===(h=i(o))&&u?u.p(o,d):(u.d(1),u=h(o),u&&(u.c(),u.m(e,t))),d&1&&(_=o[0],me(),n=ge(n,d,c,1,o,_,s,e,_e,re,l,se),pe())},i(o){if(!g){for(let d=0;d<_.length;d+=1)D(n[d]);D(a.$$.fragment,o),g=!0}},o(o){for(let d=0;d<n.length;d+=1)q(n[d]);q(a.$$.fragment,o),g=!1},d(o){o&&w(e),u.d();for(let d=0;d<n.length;d+=1)n[d].d();z(a)}}}function Ue(r){const e=document.createElement("div");return e.innerHTML=r,e.innerText}function Ye(r){return r.replaceAll(/[\u200B-\u200D\uFEFF]/g,"").trim()}function Ke(r,e,t){let n;he(r,te,i=>t(1,n=i));let s=[],l;te.subscribe(i=>{i?a():t(0,s=[])});function a(){const i=gapi.client.gmail.users.messages.list({userId:"me",labelIds:"INBOX",maxResults:20,q:"is:unread unsubscribe",pageToken:l});console.log("REQUEST",i),i.execute(function(h){l=h.nextPageToken;for(const u of h.messages)gapi.client.gmail.users.messages.get({userId:"me",id:u.id}).execute(g)})}function g(i){console.log(i);const h=Pe(i.payload);Promise.all(Re(i.payload).map(u=>gapi.client.gmail.users.messages.attachments.get({userId:"me",messageId:i.id,id:u.body.attachmentId}).getPromise().then(_=>(_.mime=u.mimeType,_.alt=u.filename,_)))).then(u=>{u=u.map(_=>"data:"+_.mime+";base64,"+_.result.data.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),console.log(u),t(0,s=[...s,{id:i.id,snippet:Ye(Ue(i.snippet)),senderName:ze(i.payload.headers,"From"),date:new Date(i.internalDate),body:h,imgs:u}])})}return[s,n,a]}class Ve extends P{constructor(e){super();R(this,e,Ke,Ge,x,{})}}function Ze(r){let e,t,n;return t=new Ve({}),{c(){e=p("main"),T(t.$$.fragment),m(e,"class","max-w-lg min-h-screen mx-auto w-screen border border-black")},m(s,l){k(s,e,l),A(t,e,null),n=!0},p:N,i(s){n||(D(t.$$.fragment,s),n=!0)},o(s){q(t.$$.fragment,s),n=!1},d(s){s&&w(e),z(t)}}}class Qe extends P{constructor(e){super();R(this,e,null,Ze,x,{})}}new Qe({target:document.getElementById("app")});
