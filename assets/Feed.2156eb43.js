var ce=Object.defineProperty,ue=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var j=(n,e,t)=>e in n?ce(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$=(n,e)=>{for(var t in e||(e={}))de.call(e,t)&&j(n,t,e[t]);if(x)for(var t of x(e))me.call(e,t)&&j(n,t,e[t]);return n},ee=(n,e)=>ue(n,fe(e));import{S as B,i as C,s as H,e as b,c as m,d as w,j as E,k as M,B as ge,C as he,D as ie,E as ae,a as y,F as te,y as L,b as T,f as d,z as F,G as ne,q,t as z,A as R,H as _e,w as be,u as pe,I as Ie,p as ye,J as ve}from"./vendor.a0249c8d.js";import{s as oe}from"./svelte.12aa2442.js";import{u as ke,g as we,a as Me,f as Ne,b as Ee}from"./gapi.98da7faa.js";function Se(n){let e;return{c(){e=b("div"),m(e,"class","flex-grow-[999]")},m(t,l){w(t,e,l)},p:E,i:E,o:E,d(t){t&&M(e)}}}class se extends B{constructor(e){super();C(this,e,null,Se,H,{})}}function Te(n){let e;return{c(){e=b("div"),ge(e,"width","0")},m(t,l){w(t,e,l),n[5](e)},p:E,i:E,o:E,d(t){t&&M(e),n[5](null)}}}function qe(n,e,t){let{threshold:l=0}=e,{horizontal:o=!1}=e,{elementScroll:r}=e,{hasMore:u=!0}=e;const a=he();let g=!1,s;const i=c=>{c.target,(o?c.target.scrollWidth-c.target.clientWidth-c.target.scrollLeft:c.target.scrollHeight-c.target.clientHeight-c.target.scrollTop)<=l?(!g&&u&&a("loadMore"),g=!0):g=!1};ie(()=>{if(s||r){const c=r||s.parentNode;c.removeEventListener("scroll",null),c.removeEventListener("resize",null)}});function h(c){ae[c?"unshift":"push"](()=>{s=c,t(0,s)})}return n.$$set=c=>{"threshold"in c&&t(1,l=c.threshold),"horizontal"in c&&t(2,o=c.horizontal),"elementScroll"in c&&t(3,r=c.elementScroll),"hasMore"in c&&t(4,u=c.hasMore)},n.$$.update=()=>{if(n.$$.dirty&9&&(s||r)){const c=r||s.parentNode;c.addEventListener("scroll",i),c.addEventListener("resize",i)}},[s,l,o,r,u,h]}class ze extends B{constructor(e){super();C(this,e,qe,Te,H,{threshold:1,horizontal:2,elementScroll:3,hasMore:4})}}function De(n){let e;return{c(){e=b("iframe"),m(e,"class","h-full w-full overflow-hidden"),m(e,"srcdoc",n[3]),m(e,"scrolling","no"),m(e,"disabled","")},m(t,l){w(t,e,l)},p(t,l){l&8&&m(e,"srcdoc",t[3])},d(t){t&&M(e)}}}function Le(n){let e,t;return{c(){e=b("img"),m(e,"class","h-full w-full"),T(e.src,t=n[4][0])||m(e,"src",t),m(e,"alt","TODO")},m(l,o){w(l,e,o)},p(l,o){o&16&&!T(e.src,t=l[4][0])&&m(e,"src",t)},d(l){l&&M(e)}}}function Fe(n){let e,t,l,o,r,u,a,g,s,i,h,c,f,W,J,S,Q,p,O,X,P,K,N,V,A,Y,U,G,v;i=new se({});function Z(_,k){return _[4][0]?Le:De}let D=Z(n),I=D(n);return N=new se({}),{c(){e=b("div"),t=b("div"),l=b("button"),o=b("img"),u=y(),a=b("span"),g=te(n[0]),s=y(),L(i.$$.fragment),h=y(),c=b("button"),f=b("img"),J=y(),S=b("div"),I.c(),Q=y(),p=b("div"),O=b("button"),O.textContent="\u2764\uFE0F",X=y(),P=b("button"),P.textContent="\u{1F4AC}",K=y(),L(N.$$.fragment),V=y(),A=b("button"),A.textContent="\u{1F6A9}",Y=y(),U=b("p"),G=te(n[2]),m(o,"class","h-4 rounded-full"),T(o.src,r=n[1])||m(o,"src",r),m(o,"alt","profile picture"),m(f,"class","h-4"),T(f.src,W=oe)||m(f,"src",W),m(f,"alt","more options"),m(t,"class","flex h-4 items-center"),m(S,"class","aspect-square w-full border border-red"),m(p,"class","flex"),m(e,"class","border border-black")},m(_,k){w(_,e,k),d(e,t),d(t,l),d(l,o),d(t,u),d(t,a),d(a,g),d(t,s),F(i,t,null),d(t,h),d(t,c),d(c,f),d(e,J),d(e,S),I.m(S,null),d(e,Q),d(e,p),d(p,O),d(p,X),d(p,P),d(p,K),F(N,p,null),d(p,V),d(p,A),d(e,Y),d(e,U),d(U,G),n[7](e),v=!0},p(_,[k]){(!v||k&2&&!T(o.src,r=_[1]))&&m(o,"src",r),(!v||k&1)&&ne(g,_[0]),D===(D=Z(_))&&I?I.p(_,k):(I.d(1),I=D(_),I&&(I.c(),I.m(S,null))),(!v||k&4)&&ne(G,_[2])},i(_){v||(q(i.$$.fragment,_),q(N.$$.fragment,_),v=!0)},o(_){z(i.$$.fragment,_),z(N.$$.fragment,_),v=!1},d(_){_&&M(e),R(i),I.d(),R(N),n[7](null)}}}function Re(n,e,t){let{id:l}=e,{senderName:o}=e,{senderImg:r}=e,{description:u}=e,{body:a}=e,{mainImg:g}=e,s;function i(){console.log("Message",l,"has been read"),h.disconnect(),gapi.client.gmail.users.messages.modify({userId:"me",id:l,resource:{removeLabelIds:["UNREAD"]}})}const h=new IntersectionObserver(function(f){f[0].isIntersecting===!0&&i()},{threshold:[1]});_e(()=>{h.observe(s)}),ie(()=>{h.disconnect()});function c(f){ae[f?"unshift":"push"](()=>{s=f,t(5,s)})}return n.$$set=f=>{"id"in f&&t(6,l=f.id),"senderName"in f&&t(0,o=f.senderName),"senderImg"in f&&t(1,r=f.senderImg),"description"in f&&t(2,u=f.description),"body"in f&&t(3,a=f.body),"mainImg"in f&&t(4,g=f.mainImg)},[o,r,u,a,g,s,l,c]}class Be extends B{constructor(e){super();C(this,e,Re,Fe,H,{id:6,senderName:0,senderImg:1,description:2,body:3,mainImg:4})}}function le(n,e,t){const l=n.slice();return l[4]=e[t],l}function re(n,e){let t,l,o;return l=new Be({props:{id:e[4].id,senderName:e[4].senderName,senderImg:oe,description:e[4].snippet,mainImg:e[4].imgs,body:e[4].body}}),{key:n,first:null,c(){t=be(),L(l.$$.fragment),this.first=t},m(r,u){w(r,t,u),F(l,r,u),o=!0},p(r,u){e=r;const a={};u&1&&(a.id=e[4].id),u&1&&(a.senderName=e[4].senderName),u&1&&(a.description=e[4].snippet),u&1&&(a.mainImg=e[4].imgs),u&1&&(a.body=e[4].body),l.$set(a)},i(r){o||(q(l.$$.fragment,r),o=!0)},o(r){z(l.$$.fragment,r),o=!1},d(r){r&&M(t),R(l,r)}}}function Ce(n){let e,t=[],l=new Map,o,r,u,a=n[0];const g=s=>s[4].id;for(let s=0;s<a.length;s+=1){let i=le(n,a,s),h=g(i);l.set(h,t[s]=re(h,i))}return r=new ze({props:{hasMore:!0,threshold:100}}),r.$on("loadMore",n[1]),{c(){e=b("div");for(let s=0;s<t.length;s+=1)t[s].c();o=y(),L(r.$$.fragment),m(e,"class","h-full")},m(s,i){w(s,e,i);for(let h=0;h<t.length;h+=1)t[h].m(e,null);d(e,o),F(r,e,null),u=!0},p(s,[i]){i&1&&(a=s[0],pe(),t=Ie(t,i,g,1,s,a,l,e,ve,re,o,le),ye())},i(s){if(!u){for(let i=0;i<a.length;i+=1)q(t[i]);q(r.$$.fragment,s),u=!0}},o(s){for(let i=0;i<t.length;i+=1)z(t[i]);z(r.$$.fragment,s),u=!1},d(s){s&&M(e);for(let i=0;i<t.length;i+=1)t[i].d();R(r)}}}function He(n){const e=document.createElement("div");return e.innerHTML=n,e.innerText}function Oe(n){return n.replaceAll(/[\u200B-\u200D\uFEFF]/g,"").trim()}function Pe(n,e,t){let l=[],o;ke.subscribe(a=>{a?r():t(0,l=[])});function r(){const a=gapi.client.gmail.users.messages.list({userId:"me",labelIds:"INBOX",maxResults:10,q:"is:unread unsubscribe",pageToken:o});console.log("REQUEST",a),a.execute(function(g){o=g.result.nextPageToken;for(const s of g.result.messages)gapi.client.gmail.users.messages.get({userId:"me",id:s.id}).execute(u)})}function u(a){console.log(a);const g=we(a.payload);Promise.all(Me(a.payload).map(s=>gapi.client.gmail.users.messages.attachments.get({userId:"me",messageId:a.id,id:s.body.attachmentId}).then(i=>ee($({},i),{mime:s.mimeType,alt:s.filename})))).then(s=>{let i=s.map(h=>"data:"+h.mime+";base64,"+Ne(h.result.data));console.log(s),t(0,l=[...l,{id:a.id,snippet:Oe(He(a.snippet)),senderName:Ee(a.payload.headers,"From"),date:new Date(a.internalDate),body:g,imgs:i}])})}return[l,r]}class Je extends B{constructor(e){super();C(this,e,Pe,Ce,H,{})}}export{Je as default};
